Untitled
================
2025-09-24

``` r
library(tidyverse)
```

    ## ── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
    ## ✔ dplyr     1.1.4     ✔ readr     2.1.5
    ## ✔ forcats   1.0.0     ✔ stringr   1.5.1
    ## ✔ ggplot2   3.5.2     ✔ tibble    3.3.0
    ## ✔ lubridate 1.9.4     ✔ tidyr     1.3.1
    ## ✔ purrr     1.1.0     
    ## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
    ## ✖ dplyr::filter() masks stats::filter()
    ## ✖ dplyr::lag()    masks stats::lag()
    ## ℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors

``` r
library(readxl)
options(tibble.print_min = 5)
```

# Problem 1

## 1.1 pols_month

``` r
pols_month = 
  read_csv(
    "./fivethirtyeight_datasets/pols-month.csv",
    na = c("NA", "", ".")) |>
  janitor::clean_names() |>
  separate(mon, into = c("year", "month","day"), sep = "-")|>
  mutate(
    year = as.integer(year),
    month = as.integer(month),
    day = as.integer(day),
    month = 
      case_match(
        month, 
        01 ~ "Jan", 
        02 ~ "Feb",
        03 ~ "Mar",
        04 ~ "Apr",
        05 ~ "May",
        06 ~ "Jun",
        07 ~ "Jul",
        08 ~ "Aug",
        09 ~ "Sep",
        10 ~ "Oct",
        11 ~ "Nov",
        12 ~ "Dec"),
    month = as.factor(month),
    year = as.factor(year)) |>
  relocate(prez_dem,prez_gop) |>
  pivot_longer(
    prez_dem:prez_gop,
    names_to = "president", 
    values_to = "prez_dem_or_prez_gop",
    names_prefix = "prez_" ) |>
  filter(prez_dem_or_prez_gop == 1)|>
  select(-day,-prez_dem_or_prez_gop)|>
  select(year,month,everything())
```

    ## Rows: 822 Columns: 9
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## dbl  (8): prez_gop, gov_gop, sen_gop, rep_gop, prez_dem, gov_dem, sen_dem, r...
    ## date (1): mon
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

## 1.2 snp

``` r
snp = 
  read_csv(
    "./fivethirtyeight_datasets/snp.csv",
    na = c("NA", "", ".")) |>
  janitor::clean_names() |>
  separate(date, into = c( "month","day","year"), sep = "/")|>
  mutate(
    month = as.integer(month),
    year = as.integer(year),
    month = 
      case_match(
        month, 
        1 ~ "Jan", 
        2 ~ "Feb",
        3 ~ "Mar",
        4 ~ "Apr",
        5 ~ "May",
        6 ~ "Jun",
        7 ~ "Jul",
        8 ~ "Aug",
        9 ~ "Sep",
        10 ~ "Oct",
        11 ~ "Nov",
        12 ~ "Dec")) |>
  mutate(
  year = case_when(
    year >= 50 ~ paste0("19", year), 
    year < 50 ~ paste0("20", year)),
    month = as.factor(month),
    year = as.factor(year)
)|>
  select(-day)|>
  select(year,month,everything())
```

    ## Rows: 787 Columns: 2
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## chr (1): date
    ## dbl (1): close
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

## 1.3 unemployment

``` r
unemployment = 
  read_csv(
    "./fivethirtyeight_datasets/unemployment.csv",
    na = c("NA", "", ".")) |>
  janitor::clean_names()|>
  pivot_longer(
    jan:dec,
    names_to = "month", 
    values_to = "unemployment") |>
   mutate(
    year = as.integer(year),
    month = 
      case_match(
        month, 
        "jan" ~ "Jan", 
        "feb" ~ "Feb",
        "mar" ~ "Mar",
        "apr" ~ "Apr",
        "may" ~ "May",
        "jun" ~ "Jun",
        "jul" ~ "Jul",
        "aug" ~ "Aug",
        "sep" ~ "Sep",
        "oct" ~ "Oct",
        "nov" ~ "Nov",
        "dec" ~ "Dec"),
    month = as.factor(month),
    year = as.factor(year)) |>
    select(year,month,everything())
```

    ## Rows: 68 Columns: 13
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## dbl (13): Year, Jan, Feb, Mar, Apr, May, Jun, Jul, Aug, Sep, Oct, Nov, Dec
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

## 1.4 dataset1 merged

``` r
dataset1_merged = 
  full_join(pols_month, snp, by = c("year","month")) |>
  full_join(unemployment, by = c("year","month"))
```

## 1.5 descriptions

The first dataset`pols_month`contained information about the political
composition of government by month, including the number of Republican
and Democratic governors, senators, representatives, and the political
party of the sitting president. The data was restructured to create a
single variable indicating whether the president was Democratic or
Republican for each time period.

The second dataset`snp`contained stock market index closing values by
date. The dates were reformatted and years were converted from 2-digit
to 4-digit format (with years ≥50 treated as 1950s-1990s and years \<50
as 2000s-2040s).

The third dataset`unemployment`contained monthly unemployment
percentages by year in wide format, which was pivoted to long format
with sxeparate month and unemployment rate columns.

The final dataset`dataset1_merged`combined all three sources, using full
joins on year and month variables. It spans multiple decades and
includes key variables such as `year`, `month`, `president` (party
affiliation), numbers of Republican and Democratic officials in various
government positions (`gov_gop`, `sen_gop`, `rep_gop`, `gov_dem`,
`sen_dem`, `rep_dem`), closing values (`close`), and unemployment rates
(`unemployment`), which provided a comprehensive view of political
composition, economic indicators, and market performance over time,
allowing for analysis of relationships between political control, stock
market performance, and unemployment rates.

# Problem 2

## 2.1 Mr. Trash Wheel sheet

``` r
Mr_Trash_wheel = 
  read_excel(
    "./trashwheel_datasets/202409 Trash Wheel Collection Data.xlsx",
    sheet = 1,
    na = c("NA", "", "."),
    skip = 1) |>
  janitor::clean_names() |>
  drop_na(dumpster) |>
  mutate(sports_balls_rounded = round(sports_balls))|>
  select(-sports_balls,-x15,-x16) |>
  mutate(sports_balls_rounded = as.integer(sports_balls_rounded)) |>
  mutate(year = as.double(year))
```

    ## New names:
    ## • `` -> `...15`
    ## • `` -> `...16`

## 2.2 Professor Trash Wheel sheet

``` r
Prof_Trash_wheel = 
  read_excel(
    "./trashwheel_datasets/202409 Trash Wheel Collection Data.xlsx",
    sheet = 2,
    na = c("NA", "", "."),
    skip = 1) |>
  janitor::clean_names() |>
  drop_na(dumpster)
```

## 2.3 Gwynnda sheet

``` r
Gwynnda = 
  read_excel(
    "./trashwheel_datasets/202409 Trash Wheel Collection Data.xlsx",
    sheet = 3,
    na = c("NA", "", "."),
    skip = 1) |>
  janitor::clean_names() |>
  drop_na(dumpster) 
```

## 2.4 dataset2 merged

``` r
dataset2_merged = 
  full_join(Mr_Trash_wheel, Prof_Trash_wheel, by = c("dumpster","month","year","date","weight_tons","volume_cubic_yards","plastic_bottles","polystyrene","cigarette_butts","plastic_bags","wrappers","homes_powered")) |>
  full_join(Gwynnda, by = c("dumpster","month","year","date","weight_tons","volume_cubic_yards","plastic_bottles","polystyrene","cigarette_butts","plastic_bags","wrappers","homes_powered"))
```

## 2.5 descriptions

The resulting dataset contains information from all three Trash Wheel
collectors (`Mr_Trash_wheel`, `Prof_Trash_wheel`, and `Gwynnda`) with
802 observations and 15 variables. Every observation has its identical
variables
`dumpster`,`month`,`year`,`date`,`weight_tons`,`volume_cubic_yards`,`plastic_bottles`,`polystyrene`,`cigarette_butts`,`plastic_bags`,`wrappers`,`homes_powered`,meanwhile
some of the observations has the `glass_bottles`,`sports_balls`.

### 2.5.1 total weight tons (Professor Trash Wheel)

``` r
Prof_Trash_wheel |>
  drop_na(weight_tons) |>
  summarize(total_weight_tons = sum(weight_tons))
```

    ## # A tibble: 1 × 1
    ##   total_weight_tons
    ##               <dbl>
    ## 1              247.

### 2.5.2 total cigarette butts (Gwynnda June 2022)

``` r
Gwynnda|>
  filter(year == "2022", month == "June") |>
  summarize(total_cigarette_butts = sum(cigarette_butts))
```

    ## # A tibble: 1 × 1
    ##   total_cigarette_butts
    ##                   <dbl>
    ## 1                  2800

# Problem 3

## 3.1 zip codes dataset

``` r
zip_codes = 
  read_csv(
    "./zillow_data/Zip Codes.csv",
    na = c("NA", "", ".")) |>
  janitor::clean_names() |>
  separate(file_date, into = c("month","day","year"), sep = "/") |>
  select(-state_fips,-county_code) |>
  mutate(zip_code = as.character(zip_code)) |>
  arrange(zip_code, year,month,day) |>
  mutate(year = if_else(year == "07", "2007", year)) |>
  select(county,zip_code,year,month,day,everything())
```

    ## Rows: 322 Columns: 7
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## chr (4): County, County Code, File Date, Neighborhood
    ## dbl (3): State FIPS, County FIPS, ZipCode
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

## 3.2 zori dataset

``` r
zori = 
  read_csv(
    "./zillow_data/Zip_zori_uc_sfrcondomfr_sm_month_NYC.csv",
    na = c("NA", "", ".")) |>
  janitor::clean_names() |>
  rename(zip_code = region_name,county = county_name) |>
  mutate(zip_code = as.character(zip_code))
```

    ## Rows: 149 Columns: 125
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## chr   (6): RegionType, StateName, State, City, Metro, CountyName
    ## dbl (119): RegionID, SizeRank, RegionName, 2015-01-31, 2015-02-28, 2015-03-3...
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

## 3.3 zori rent price dataset

``` r
zori_rent_price =
  zori |>
  mutate(county = str_remove(county, " County")) |>
  pivot_longer(
    cols = starts_with("x"),
    names_to = "date", 
    values_to = "rent_price",
    names_prefix = "x"
  ) |>
  mutate(zip_code = as.character(zip_code)) |>
  filter(!is.na(rent_price)) |>
  arrange(zip_code, date) |>
  separate(date, into = c("year","month","day"), sep = "_") |>
  select(county,zip_code,year,month,day,everything())
```

## 3.4 dataset3 merged

``` r
dataset3_merged = 
  full_join(zip_codes,zori_rent_price,by = c("zip_code","county","year","month","day"))
dataset3_merged
```

    ## # A tibble: 10,772 × 15
    ##   county zip_code year  month day   county_fips neighborhood region_id size_rank
    ##   <chr>  <chr>    <chr> <chr> <chr>       <dbl> <chr>            <dbl>     <dbl>
    ## 1 New Y… 10001    2007  7     25          36061 Chelsea and…        NA        NA
    ## 2 New Y… 10002    2007  7     25          36061 Lower East …        NA        NA
    ## 3 New Y… 10003    2007  7     25          36061 Lower East …        NA        NA
    ## 4 New Y… 10004    2007  7     25          36061 Lower Manha…        NA        NA
    ## 5 New Y… 10005    2007  7     25          36061 Lower Manha…        NA        NA
    ## # ℹ 10,767 more rows
    ## # ℹ 6 more variables: region_type <chr>, state_name <chr>, state <chr>,
    ## #   city <chr>, metro <chr>, rent_price <dbl>

## 3.5 descriptions

The resulting dataset contains information from two zillow datasets
(`zip_codes`and`zori`) with 10772 observations and 15 variables. Every
observation has its identical variables
`county`,`zip_code`,`month`,`year`,`day`, and some other variables such
as`county_fips`,`neighborhood`,`region_id`,`size_rank`etc.

### 3.5.1 unique zip codes

``` r
unique_zips_merged =
  dataset3_merged |>
  distinct(zip_code) |>
  nrow()
print(unique_zips_merged)
```

    ## [1] 320

### 3.5.2 unique neighborhoods

``` r
unique_neighborhoods_merged =
  dataset3_merged |>
  drop_na(neighborhood) |>
  distinct(neighborhood) |>
  nrow()
print(unique_neighborhoods_merged)
```

    ## [1] 42

### 3.5.3 unique zip codes in `zip_codes`

``` r
zip_codes_only =
  zip_codes |>
  distinct(zip_code) |>
  anti_join(zori |> distinct(zip_code), by = "zip_code")
print(zip_codes_only)
```

    ## # A tibble: 171 × 1
    ##   zip_code
    ##   <chr>   
    ## 1 10008   
    ## 2 10020   
    ## 3 10041   
    ## 4 10043   
    ## 5 10045   
    ## # ℹ 166 more rows

### 3.5.4 top 10 price drops

``` r
top10_drops =
  zori_rent_price |>
  drop_na(rent_price) |>
  filter(year == c("2020","2021"), month == "01", day == "31") |> 
  select(zip_code, year, rent_price) |>
  pivot_wider(
    names_from = year, 
    values_from = rent_price,
    names_prefix = "year_") |>
  mutate(drop = year_2020 - year_2021) |>
  arrange(desc(drop)) |>
  slice_head(n = 10)
print(top10_drops)
```

    ## # A tibble: 10 × 4
    ##    zip_code year_2020 year_2021  drop
    ##    <chr>        <dbl>     <dbl> <dbl>
    ##  1 10016        3731.     3019.  712.
    ##  2 10128        2917.     2404.  513.
    ##  3 10001        4108.       NA    NA 
    ##  4 10002        3645.       NA    NA 
    ##  5 10003        3570.       NA    NA 
    ##  6 10004        3150.       NA    NA 
    ##  7 10005        3408.       NA    NA 
    ##  8 10007        6334.       NA    NA 
    ##  9 10009        3406.       NA    NA 
    ## 10 10010        3697.       NA    NA
